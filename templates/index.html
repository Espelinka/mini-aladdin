<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ú–∏–Ω–∏-Aladdin üíº</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body { background: #f9fafb; }
        .card { border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .btn { transition: all 0.2s; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        .crypto-tag { background: #dbeafe; color: #1d4ed8; }
        .stock-tag { background: #dcfce7; color: #16a34a; }
    </style>
</head>
<body class="text-gray-800">
    <div class="max-w-6xl mx-auto p-4">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-2xl font-bold flex items-center gap-2">
                <i class="fas fa-chart-line"></i> –ú–∏–Ω–∏-Aladdin
            </h1>
            <div>
                <span class="text-lg font-semibold text-green-600 mr-4">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${{ total_value }}</span>
                <a href="/export" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 mr-2">
                    <i class="fas fa-file-excel"></i> Excel
                </a>
                <a href="/logout" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </a>
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
        <div class="bg-white p-6 mb-6 card">
            <h2 class="text-xl font-semibold mb-4">‚ûï –ù–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è</h2>
            <form method="POST" class="grid grid-cols-1 md:grid-cols-5 gap-3">
                <input type="text" name="symbol" placeholder="–¢–∏–∫–µ—Ä (BTC, AAPL...)" class="p-2 border rounded" required>
                <select name="type" class="p-2 border rounded" required>
                    <option value="crypto">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
                    <option value="stock">–ê–∫—Ü–∏—è</option>
                </select>
                <input type="number" name="amount" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" step="any" min="0.000001" class="p-2 border rounded" required>
                <button name="action" value="buy" class="btn bg-blue-600 text-white rounded hover:bg-blue-700">–ö—É–ø–∏—Ç—å</button>
                <button name="action" value="sell" class="btn bg-red-600 text-white rounded hover:bg-red-700">–ü—Ä–æ–¥–∞—Ç—å</button>
            </form>
            <div class="mt-3 text-sm text-gray-600">
                üí° –ö—Ä–∏–ø—Ç–æ-—Ç–∏–∫–µ—Ä: {{ crypto_tickers | join(', ') }}
            </div>
        </div>

        <!-- –ü–æ—Ä—Ç—Ñ–µ–ª—å -->
        {% if portfolio %}
        <div class="bg-white p-6 mb-6 card">
            <h2 class="text-xl font-semibold mb-4">üíº –¢–µ–∫—É—â–∏–π –ø–æ—Ä—Ç—Ñ–µ–ª—å</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">–ê–∫—Ç–∏–≤</th>
                            <th class="px-4 py-2 text-left">–¢–∏–ø</th>
                            <th class="px-4 py-2 text-right">–ö–æ–ª-–≤–æ</th>
                            <th class="px-4 py-2 text-right">–¶–µ–Ω–∞</th>
                            <th class="px-4 py-2 text-right">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        {% for item in portfolio %}
                        <tr>
                            <td class="px-4 py-2 font-mono">{{ item.symbol }}</td>
                            <td class="px-4 py-2">
                                <span class="px-2 py-1 rounded text-xs {% if item.type == 'crypto' %}crypto-tag{% else %}stock-tag{% endif %}">
                                    {{ '–ö—Ä–∏–ø—Ç–∞' if item.type == 'crypto' else '–ê–∫—Ü–∏—è' }}
                                </span>
                            </td>
                            <td class="px-4 py-2 text-right">{{ "%.6f"|format(item.amount) if item.amount < 1 else item.amount }}</td>
                            <td class="px-4 py-2 text-right">${{ "%.4f"|format(item.price) if item.price else '‚Äî' }}</td>
                            <td class="px-4 py-2 text-right font-medium {{ 'positive' if item.value > 0 else 'negative' }}">
                                ${{ item.value }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π -->
        <div class="bg-white p-6 card">
            <h2 class="text-xl font-semibold mb-4">üìú –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left">–î–∞—Ç–∞</th>
                            <th class="px-4 py-2 text-left">–¢–∏–∫–µ—Ä</th>
                            <th class="px-4 py-2 text-left">–¢–∏–ø</th>
                            <th class="px-4 py-2 text-left">–û–ø–µ—Ä–∞—Ü–∏—è</th>
                            <th class="px-4 py-2 text-right">–ö–æ–ª-–≤–æ</th>
                            <th class="px-4 py-2 text-right">–¶–µ–Ω–∞</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        {% for t in transactions %}
                        <tr>
                            <td class="px-4 py-2 text-sm">{{ t.date }}</td>
                            <td class="px-4 py-2 font-mono">{{ t.symbol }}</td>
                            <td class="px-4 py-2">
                                <span class="text-xs px-2 py-1 rounded {% if t.asset_type == 'crypto' %}crypto-tag{% else %}stock-tag{% endif %}">
                                    {{ '–ö—Ä–∏–ø—Ç–∞' if t.asset_type == 'crypto' else '–ê–∫—Ü–∏—è' }}
                                </span>
                            </td>
                            <td class="px-4 py-2">
                                <span class="px-2 py-1 rounded text-xs font-medium {% if t.operation == 'buy' %}bg-blue-100 text-blue-800{% else %}bg-red-100 text-red-800{% endif %}">
                                    {{ '–ü–æ–∫—É–ø–∫–∞' if t.operation == 'buy' else '–ü—Ä–æ–¥–∞–∂–∞' }}
                                </span>
                            </td>
                            <td class="px-4 py-2 text-right">{{ "%.6f"|format(t.amount) if t.amount < 1 else t.amount }}</td>
                            <td class="px-4 py-2 text-right">${{ "%.4f"|format(t.price_at_operation) if t.price_at_operation else '‚Äî' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
